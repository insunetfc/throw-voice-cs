# Check if mulaw 8k
ffprobe -hide_banner -show_streams -of json audio.wav

# convert to mp3 - single fixed file name
ffmpeg -hide_banner -i hifi.wav -ar 22050 -ac 1 -c:a libmp3lame -q:a 6 hifi.mp3

# convert to mp3 - recursively
for f in *.wav; do     ffmpeg -hide_banner -i "$f" -ar 22050 -ac 1 -c:a libmp3lame -q:a 6 "${f%.wav}.mp3"; done


# Recursively convert WAV â†’ MP3 (22.05 kHz, mono, q=6)
find . -type f -iname "*.wav" -print0 | \
xargs -0 -I{} sh -c '
    in="{}"
    out="${in%.*}.mp3"
    echo "Converting $in -> $out"
    ffmpeg -hide_banner -loglevel error -y \
        -i "$in" \
        -ar 22050 -ac 1 -c:a libmp3lame -q:a 6 \
        "$out"
'


# generate fillers (Make sure synthesize is running)
python3 generate_preset.py \
  --input presets/filler.json \
  --output_dir out/filler_speech \
  --s3_bucket tts-bucket-250810 \
  --s3_prefix filler/

# create DynamoDB table
aws dynamodb create-table \
    --table-name ConnectPromptCache \
    --attribute-definitions \
        AttributeName=PromptId,AttributeType=S \
        AttributeName=Timestamp,AttributeType=N \
    --key-schema \
        AttributeName=PromptId,KeyType=HASH \
        AttributeName=Timestamp,KeyType=RANGE \
    --provisioned-throughput ReadCapacityUnits=1,WriteCapacityUnits=1


# Download files from S3
aws s3 sync s3://tts-bucket-250810/ko-KR/ ./local_audio/