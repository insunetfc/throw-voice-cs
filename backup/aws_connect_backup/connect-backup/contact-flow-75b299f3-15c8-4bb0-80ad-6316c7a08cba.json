{
    "ContactFlow": {
        "Arn": "arn:aws:connect:ap-northeast-2:600818507157:instance/eefed165-54dc-428e-a0f1-02c2ec35a22e/contact-flow/75b299f3-15c8-4bb0-80ad-6316c7a08cba",
        "Id": "75b299f3-15c8-4bb0-80ad-6316c7a08cba",
        "Name": "CorrectedSpeechInputFlow",
        "Type": "CONTACT_FLOW",
        "State": "ACTIVE",
        "Status": "PUBLISHED",
        "Description": "Proper streaming pattern: chat_and_stream starts job, get_next_batch handles all audio",
        "Content": "{\"Version\":\"2019-10-30\",\"StartAction\":\"init_voice_settings\",\"Metadata\":{\"entryPointPosition\":{\"x\":40,\"y\":40},\"ActionMetadata\":{\"init_voice_settings\":{\"position\":{\"x\":0,\"y\":0},\"parameters\":{\"TextToSpeechVoice\":{\"languageCode\":\"ko-KR\"}},\"overrideConsoleVoice\":true},\"init_contact_data\":{\"position\":{\"x\":0,\"y\":0},\"dynamicParams\":[]},\"store_job_info\":{\"position\":{\"x\":0,\"y\":0},\"dynamicParams\":[]},\"wait_for_audio\":{\"position\":{\"x\":0,\"y\":0}},\"start_chat_stream\":{\"position\":{\"x\":0,\"y\":0},\"parameters\":{\"LambdaFunctionARN\":{\"displayName\":\"arn:aws:lambda:ap-northeast-2:600818507157:function:InvokeBotLambda\"}},\"dynamicMetadata\":{\"action\":false,\"Details.Parameters.user_input\":false,\"Details.Parameters.text\":false,\"Details.Parameters.chat_on\":false}},\"get_first_batch\":{\"position\":{\"x\":0,\"y\":0},\"parameters\":{\"LambdaFunctionARN\":{\"displayName\":\"arn:aws:lambda:ap-northeast-2:600818507157:function:InvokeBotLambda\"}},\"dynamicMetadata\":{\"action\":false,\"JobId\":false,\"NextIndex\":false,\"Limit\":false}},\"disconnect\":{\"position\":{\"x\":1336,\"y\":226.4}},\"update_batch_attributes\":{\"position\":{\"x\":0,\"y\":0},\"dynamicParams\":[]},\"error_handler\":{\"position\":{\"x\":725.6,\"y\":217.6}},\"get_next_batch_streaming\":{\"position\":{\"x\":788,\"y\":123.2},\"parameters\":{\"LambdaFunctionARN\":{\"displayName\":\"arn:aws:lambda:ap-northeast-2:600818507157:function:InvokeBotLambda\"}},\"dynamicMetadata\":{\"action\":false,\"JobId\":false,\"NextIndex\":false,\"Limit\":false}},\"check_audio_available\":{\"position\":{\"x\":0,\"y\":0},\"conditionMetadata\":[{\"id\":\"5c9f79bf-c730-443a-8082-2e143e71411b\",\"operator\":{\"name\":\"Contains\",\"value\":\"Contains\",\"shortDisplay\":\"contains\"},\"value\":\"http\"}]},\"get_user_input\":{\"position\":{\"x\":0,\"y\":0},\"parameters\":{\"LexV2Bot\":{\"AliasArn\":{}}},\"lexV2BotName\":\"\",\"conditionMetadata\":[]},\"check_more_audio\":{\"position\":{\"x\":406.4,\"y\":220},\"conditionMetadata\":[{\"id\":\"f5615cb6-ab92-4d38-a502-34e43883a28b\",\"operator\":{\"name\":\"Contains\",\"value\":\"Contains\",\"shortDisplay\":\"contains\"},\"value\":\"true\"}]},\"play_audio\":{\"position\":{\"x\":171.2,\"y\":177.6},\"parameters\":{\"LexV2Bot\":{\"AliasArn\":{}}},\"lexV2BotName\":\"\",\"conditionMetadata\":[]}},\"Annotations\":[]},\"Actions\":[{\"Parameters\":{\"TextToSpeechVoice\":\"Seoyeon\",\"TextToSpeechEngine\":\"Neural\",\"TextToSpeechStyle\":\"None\"},\"Identifier\":\"init_voice_settings\",\"Type\":\"UpdateContactTextToSpeechVoice\",\"Transitions\":{\"NextAction\":\"init_contact_data\",\"Errors\":[{\"NextAction\":\"init_contact_data\",\"ErrorType\":\"NoMatchingError\"}]}},{\"Parameters\":{\"TargetContact\":\"Current\",\"LanguageCode\":\"ko-KR\"},\"Identifier\":\"init_contact_data\",\"Type\":\"UpdateContactData\",\"Transitions\":{\"NextAction\":\"get_user_input\",\"Errors\":[{\"NextAction\":\"get_user_input\",\"ErrorType\":\"NoMatchingError\"}]}},{\"Parameters\":{\"Attributes\":{\"JobId\":\"$.External.setAttributes.JobId\",\"NextIndex\":\"$.External.setAttributes.NextIndex\",\"HasMore\":\"$.External.setAttributes.HasMore\",\"ChatAnswer\":\"$.External.setAttributes.ChatAnswer\",\"UserInput\":\"$.External.setAttributes.UserInput\"},\"TargetContact\":\"Current\"},\"Identifier\":\"store_job_info\",\"Type\":\"UpdateContactAttributes\",\"Transitions\":{\"NextAction\":\"get_first_batch\",\"Errors\":[{\"NextAction\":\"get_first_batch\",\"ErrorType\":\"NoMatchingError\"}]}},{\"Parameters\":{\"TimeLimitSeconds\":\"2\"},\"Identifier\":\"wait_for_audio\",\"Type\":\"Wait\",\"Transitions\":{\"NextAction\":\"get_first_batch\",\"Conditions\":[{\"NextAction\":\"get_first_batch\",\"Condition\":{\"Operator\":\"Equals\",\"Operands\":[\"WaitCompleted\"]}}],\"Errors\":[{\"NextAction\":\"get_first_batch\",\"ErrorType\":\"NoMatchingError\"}]}},{\"Parameters\":{\"LambdaFunctionARN\":\"arn:aws:lambda:ap-northeast-2:600818507157:function:InvokeBotLambda\",\"InvocationTimeLimitSeconds\":\"8\",\"InvocationType\":\"SYNCHRONOUS\",\"LambdaInvocationAttributes\":{\"action\":\"chat_and_stream\",\"Details.Parameters.user_input\":\"$.Lex.InputTranscript\",\"Details.Parameters.text\":\"$.Lex.InputTranscript\",\"Details.Parameters.chat_on\":\"true\"},\"ResponseValidation\":{\"ResponseType\":\"JSON\"}},\"Identifier\":\"start_chat_stream\",\"Type\":\"InvokeLambdaFunction\",\"Transitions\":{\"NextAction\":\"store_job_info\",\"Errors\":[{\"NextAction\":\"error_handler\",\"ErrorType\":\"NoMatchingError\"}]}},{\"Parameters\":{\"LambdaFunctionARN\":\"arn:aws:lambda:ap-northeast-2:600818507157:function:InvokeBotLambda\",\"InvocationTimeLimitSeconds\":\"8\",\"InvocationType\":\"SYNCHRONOUS\",\"LambdaInvocationAttributes\":{\"action\":\"get_next_batch\",\"JobId\":\"$.Attributes.JobId\",\"NextIndex\":\"$.Attributes.NextIndex\",\"Limit\":\"1\"},\"ResponseValidation\":{\"ResponseType\":\"JSON\"}},\"Identifier\":\"get_first_batch\",\"Type\":\"InvokeLambdaFunction\",\"Transitions\":{\"NextAction\":\"update_batch_attributes\",\"Errors\":[{\"NextAction\":\"error_handler\",\"ErrorType\":\"NoMatchingError\"}]}},{\"Parameters\":{},\"Identifier\":\"disconnect\",\"Type\":\"DisconnectParticipant\",\"Transitions\":{}},{\"Parameters\":{\"Attributes\":{\"AudioS3Url\":\"$.External.setAttributes.AudioS3Url0\",\"NextIndex\":\"$.External.setAttributes.NextIndexOut\",\"HasMore\":\"$.External.setAttributes.HasMore\",\"BatchCount\":\"$.External.setAttributes.BatchCount\",\"AudioS3UrlCount\":\"$.External.setAttributes.AudioS3UrlCount\"},\"TargetContact\":\"Current\"},\"Identifier\":\"update_batch_attributes\",\"Type\":\"UpdateContactAttributes\",\"Transitions\":{\"NextAction\":\"check_audio_available\",\"Errors\":[{\"NextAction\":\"check_audio_available\",\"ErrorType\":\"NoMatchingError\"}]}},{\"Parameters\":{\"Text\":\"죄송합니다. 기술적인 문제가 발생했습니다.\"},\"Identifier\":\"error_handler\",\"Type\":\"MessageParticipant\",\"Transitions\":{\"NextAction\":\"disconnect\",\"Errors\":[{\"NextAction\":\"disconnect\",\"ErrorType\":\"NoMatchingError\"}]}},{\"Parameters\":{\"LambdaFunctionARN\":\"arn:aws:lambda:ap-northeast-2:600818507157:function:InvokeBotLambda\",\"InvocationTimeLimitSeconds\":\"8\",\"InvocationType\":\"SYNCHRONOUS\",\"LambdaInvocationAttributes\":{\"action\":\"get_next_batch\",\"JobId\":\"$.Attributes.JobId\",\"NextIndex\":\"$.Attributes.NextIndex\",\"Limit\":\"1\"},\"ResponseValidation\":{\"ResponseType\":\"JSON\"}},\"Identifier\":\"get_next_batch_streaming\",\"Type\":\"InvokeLambdaFunction\",\"Transitions\":{\"NextAction\":\"update_batch_attributes\",\"Errors\":[{\"NextAction\":\"error_handler\",\"ErrorType\":\"NoMatchingError\"}]}},{\"Parameters\":{\"ComparisonValue\":\"$.Attributes.AudioS3Url\"},\"Identifier\":\"check_audio_available\",\"Type\":\"Compare\",\"Transitions\":{\"NextAction\":\"wait_for_audio\",\"Conditions\":[{\"NextAction\":\"play_audio\",\"Condition\":{\"Operator\":\"TextContains\",\"Operands\":[\"http\"]}}],\"Errors\":[{\"NextAction\":\"wait_for_audio\",\"ErrorType\":\"NoMatchingCondition\"}]}},{\"Parameters\":{\"PromptId\":\"arn:aws:connect:ap-northeast-2:600818507157:instance/eefed165-54dc-428e-a0f1-02c2ec35a22e/prompt/f61bb4fe-f0bb-47a9-a4ed-80f0e5c3025c\",\"LexV2Bot\":{\"AliasArn\":\"arn:aws:lex:ap-northeast-1:600818507157:bot-alias/ZUZDJPUFTG/LEMPGLKGYI\"}},\"Identifier\":\"get_user_input\",\"Type\":\"ConnectParticipantWithLexBot\",\"Transitions\":{\"NextAction\":\"start_chat_stream\",\"Errors\":[{\"NextAction\":\"start_chat_stream\",\"ErrorType\":\"NoMatchingCondition\"},{\"NextAction\":\"start_chat_stream\",\"ErrorType\":\"NoMatchingError\"}]}},{\"Parameters\":{\"ComparisonValue\":\"$.Attributes.HasMore\"},\"Identifier\":\"check_more_audio\",\"Type\":\"Compare\",\"Transitions\":{\"NextAction\":\"get_user_input\",\"Conditions\":[{\"NextAction\":\"get_next_batch_streaming\",\"Condition\":{\"Operator\":\"TextContains\",\"Operands\":[\"true\"]}}],\"Errors\":[{\"NextAction\":\"get_user_input\",\"ErrorType\":\"NoMatchingCondition\"}]}},{\"Parameters\":{\"Media\":{\"Uri\":\"$.Attributes.AudioS3Url\",\"SourceType\":\"S3\",\"MediaType\":\"Audio\"},\"LexV2Bot\":{\"AliasArn\":\"arn:aws:lex:ap-northeast-1:600818507157:bot-alias/ZUZDJPUFTG/LEMPGLKGYI\"},\"LexTimeoutSeconds\":{\"Text\":\"60\"}},\"Identifier\":\"play_audio\",\"Type\":\"ConnectParticipantWithLexBot\",\"Transitions\":{\"NextAction\":\"check_more_audio\",\"Errors\":[{\"NextAction\":\"get_user_input\",\"ErrorType\":\"InputTimeLimitExceeded\"},{\"NextAction\":\"check_more_audio\",\"ErrorType\":\"NoMatchingCondition\"},{\"NextAction\":\"check_more_audio\",\"ErrorType\":\"NoMatchingError\"}]}}]}",
        "Tags": {},
        "FlowContentSha256": "478115e900d15409d01472cd9f6a80559740169c17d843cdea6e81b1187c4976",
        "LastModifiedTime": "2025-08-25T16:26:08.351000+09:00",
        "LastModifiedRegion": "ap-northeast-2"
    }
}
